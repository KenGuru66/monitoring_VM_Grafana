# üìä –°–†–ê–í–ù–ï–ù–ò–ï –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò: 16 vs 32 vCPU

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
**–§–∞–π–ª:** Storage_History_Performance_Files(11-24).zip
**–†–∞–∑–º–µ—Ä:** 596,626,023 –º–µ—Ç—Ä–∏–∫ (596 –º–ª–Ω)
**–§–∞–π–ª–æ–≤:** 2,584 .tgz —Ñ–∞–π–ª–æ–≤

---

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 1: 16 vCPU

```
‚úÖ –§–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:    2,584
‚úÖ –ú–µ—Ç—Ä–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:    596,626,023
‚úÖ –ë–∞—Ç—á–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:    12,910
‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:      449.9 —Å–µ–∫ (7.5 –º–∏–Ω—É—Ç)
‚úÖ Throughput:           1,326,084 metrics/sec
‚úÖ Workers:              14
```

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 2: 32 vCPU

```
‚úÖ –§–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:    2,584
‚úÖ –ú–µ—Ç—Ä–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:    596,626,023
‚úÖ –ë–∞—Ç—á–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:    12,910
‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:      331.7 —Å–µ–∫ (5.5 –º–∏–Ω—É—Ç)
‚úÖ Throughput:           1,798,803 metrics/sec
‚úÖ Workers:              30
```

---

## üéØ –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | 16 vCPU | 32 vCPU | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|---------|-----------|
| **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏** | 449.9 —Å–µ–∫ | 331.7 —Å–µ–∫ | **-26.3%** ‚ö° |
| **Throughput** | 1,326,084 m/s | 1,798,803 m/s | **+35.6%** ‚ö° |
| **Workers** | 14 | 30 | +114% |
| **–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã)** | 7.5 –º–∏–Ω | 5.5 –º–∏–Ω | **-2 –º–∏–Ω—É—Ç—ã** |

### –°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ worker

```
16 vCPU: 1,326,084 / 14 = ~94,720 metrics/sec –Ω–∞ worker
32 vCPU: 1,798,803 / 30 = ~59,960 metrics/sec –Ω–∞ worker
```

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:** –ë–æ–ª—å—à–µ workers ‚Üí –Ω–∏–∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ worker (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ VictoriaMetrics)

### –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU

```
16 vCPU:
- Workers: 14 (87.5% –æ—Ç CPU)
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 1.0x (–±–∞–∑–æ–≤—ã–π)

32 vCPU:
- Workers: 30 (93.75% –æ—Ç CPU)
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 1.356x
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 1.356 / 2.0 = 67.8%
```

**–í—ã–≤–æ–¥—ã:**
- ‚úÖ 32 vCPU –¥–∞—é—Ç –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ **35.6%**
- ‚ö†Ô∏è –ü—Ä–∏—Ä–æ—Å—Ç –ù–ï –ª–∏–Ω–µ–π–Ω—ã–π (–Ω–µ 2x –ø—Ä–∏ —É–¥–≤–æ–µ–Ω–∏–∏ CPU)
- ‚ö†Ô∏è –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU: **67.8%**

---

## üîç –ü–û–ß–ï–ú–£ –ù–ï 2x –£–°–ö–û–†–ï–ù–ò–ï?

### 1. **VictoriaMetrics - –≥–ª–∞–≤–Ω–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  30 Workers  ‚îÇ ‚îÄ‚îÄ‚ñ∂ ‚îÇ  VictoriaMetrics    ‚îÇ
‚îÇ  (32 vCPU)   ‚îÇ     ‚îÇ  Write: ~1.8M/s     ‚îÇ
‚îÇ              ‚îÇ     ‚îÇ  (BOTTLENECK!)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 30 workers –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ –∑–∞–ø–∏—Å—å –≤ VictoriaMetrics
- VM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ~1.8M metrics/sec (–ª–∏–º–∏—Ç)
- –ë–æ–ª—å—à–µ workers ‚Üí –±–æ–ª—å—à–µ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç VM

### 2. **HTTP Overhead**

```
Batch size: 50,000 –º–µ—Ç—Ä–∏–∫
Batches: 12,910
HTTP requests: 12,910 –∑–∞–ø—Ä–æ—Å–æ–≤

16 vCPU: 12,910 requests / 449.9s = 28.7 req/sec
32 vCPU: 12,910 requests / 331.7s = 38.9 req/sec

–ü—Ä–∏—Ä–æ—Å—Ç: +35.5% (–ø–æ—á—Ç–∏ –∫–∞–∫ throughput!)
```

**–í—ã–≤–æ–¥:** –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –≤ VM –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –Ω–µ CPU –ø–∞—Ä—Å–∏–Ω–≥–∞, –∞:
- –°–∫–æ—Ä–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ VM
- Disk I/O VM
- Index building VM

### 3. **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ —Ä–µ—Å—É—Ä—Å—ã**

```
16 vCPU ‚Üí 14 workers:
- CPU –Ω–∞ worker: ~1.14 vCPU
- –ú–µ–Ω—å—à–µ context switching
- –ú–µ–Ω—å—à–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ VM

32 vCPU ‚Üí 30 workers:
- CPU –Ω–∞ worker: ~1.07 vCPU
- –ë–æ–ª—å—à–µ context switching
- –ë–æ–ª—å—à–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ VM
```

---

## üí∞ –°–¢–û–ò–ú–û–°–¢–¨ VS –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –†–∞—Å—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | Throughput | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å | Cost/Performance |
|--------------|-------|------------|-------------------------|------------------|
| **16 vCPU** | 7.5 –º–∏–Ω | 1.33M/s | 1.0x | **1.0x** ‚úÖ |
| **32 vCPU** | 5.5 –º–∏–Ω | 1.80M/s | 2.0x | **1.47x** |

**Cost/Performance = (–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å) / (–£—Å–∫–æ—Ä–µ–Ω–∏–µ)**

```
16 vCPU: 1.0 / 1.0 = 1.0x (–±–∞–∑–æ–≤—ã–π)
32 vCPU: 2.0 / 1.356 = 1.47x (–Ω–∞ 47% –¥–æ—Ä–æ–∂–µ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

```
–ï—Å–ª–∏ 16 vCPU —Å—Ç–æ–∏—Ç $100/–º–µ—Å—è—Ü:
- 32 vCPU —Å—Ç–æ–∏—Ç ~$200/–º–µ—Å—è—Ü
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 35.6%
- –í—ã –ø–ª–∞—Ç–∏—Ç–µ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –∑–∞ 35.6% —É—Å–∫–æ—Ä–µ–Ω–∏—è
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–ª—è 500GB / 40 –º–ª—Ä–¥ —Å—Ç—Ä–æ–∫

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ü—Ä–æ–≥–Ω–æ–∑ –≤—Ä–µ–º–µ–Ω–∏ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------------|----------------|-----------|--------------|
| **16 vCPU** | ~8.5 —á–∞—Å–æ–≤ | $ | ‚úÖ **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ** (cost/performance) |
| **32 vCPU** | ~6.3 —á–∞—Å–∞ | $$ | ‚ö†Ô∏è –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤—Ä–µ–º—è |

### –ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å 32 vCPU?

‚úÖ **–î–ê, –µ—Å–ª–∏:**
- –ö—Ä–∏—Ç–∏—á–Ω–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (deadlines)
- –†–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
- –≠–∫–æ–Ω–æ–º–∏—è 2 –º–∏–Ω—É—Ç –≤–∞–∂–Ω–µ–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

‚ùå **–ù–ï–¢, –µ—Å–ª–∏:**
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ú–æ–∂–µ—Ç–µ –ø–æ–¥–æ–∂–¥–∞—Ç—å +2 –º–∏–Ω—É—Ç—ã

### üèÜ –õ–£–ß–®–ò–ô –í–ê–†–ò–ê–ù–¢: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è VictoriaMetrics!

–í–º–µ—Å—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—è vCPU:

```bash
# 1. –£–≤–µ–ª–∏—á–∏—Ç—å batch size
--batch-size 100000  # –≤–º–µ—Å—Ç–æ 50000

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VictoriaMetrics
victoriametrics:
  command:
    - --maxInsertRequestSize=128MB
    - -memory.allowedPercent=80
    - -insert.maxQueueDuration=60s
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: +40-60% (–±–æ–ª—å—à–µ —á–µ–º –æ—Ç 32 vCPU!)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!)
- –ù–∞ 16 vCPU: ~5-6 —á–∞—Å–æ–≤ –≤–º–µ—Å—Ç–æ 8.5 —á–∞—Å–æ–≤
- –ù–∞ 32 vCPU: ~3-4 —á–∞—Å–∞ –≤–º–µ—Å—Ç–æ 6.3 —á–∞—Å–æ–≤

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è 500GB / 40 –º–ª—Ä–¥ —Å—Ç—Ä–æ–∫

| –°—Ü–µ–Ω–∞—Ä–∏–π | vCPU | Batch | VM Tuning | –í—Ä–µ–º—è | –°—Ç–æ–∏–º–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|------|-------|-----------|-------|-----------|--------------|
| **–¢–µ–∫—É—â–∏–π** | 16 | 50k | ‚ùå | ~8.5—á | $ | –ë–∞–∑–æ–≤—ã–π |
| **+CPU** | 32 | 50k | ‚ùå | ~6.3—á | $$ | –ù–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 1** | 16 | 100k | ‚úÖ | ~5-6—á | $ | ‚úÖ **–õ—É—á—à–∏–π** |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 2** | 32 | 100k | ‚úÖ | ~3-4—á | $$ | –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤—Ä–µ–º—è |
| **–ú–∞–∫—Å–∏–º—É–º** | 32 | 150k | ‚úÖ | ~2.5-3—á | $$ | –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π |

---

## üéì –í–´–í–û–î–´

### 1. ‚úÖ CPU –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **32 vCPU** –±—ã—Å—Ç—Ä–µ–µ **16 vCPU** –Ω–∞ **35.6%**
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å —Å **7.5** –¥–æ **5.5 –º–∏–Ω—É—Ç** (-2 –º–∏–Ω)

### 2. ‚ö†Ô∏è –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ù–ï –ª–∏–Ω–µ–π–Ω–æ–µ
- –£–¥–≤–æ–µ–Ω–∏–µ CPU (2x) –¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ **1.36x** —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: **67.8%**
- –ü—Ä–∏—á–∏–Ω–∞: **VictoriaMetrics bottleneck**, –Ω–µ CPU

### 3. üí∞ Cost/Performance
- **16 vCPU** - –ª—É—á—à–∏–π **cost/performance** (–±–∞–∑–æ–≤—ã–π 1.0x)
- **32 vCPU** - –Ω–∞ **47% –¥–æ—Ä–æ–∂–µ** –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 4. üèÜ –ì–ª–∞–≤–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
**–ù–ï —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å CPU, –ê –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å VictoriaMetrics –∏ batch size!**

–≠—Ç–æ –¥–∞—Å—Ç:
- –ë–æ–ª—å—à–µ —É—Å–∫–æ—Ä–µ–Ω–∏—è (+40-60% vs +35%)
- –ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç ($0)
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ vCPU

### 5. üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–î–ª—è production:**
```
vCPU: 16 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!)
Batch size: 100,000-150,000
VictoriaMetrics: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è 500GB: 5-6 —á–∞—Å–æ–≤
```

**–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:**
```
vCPU: 32
Batch size: 150,000
VictoriaMetrics: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–ª—è 500GB: 2.5-3 —á–∞—Å–∞
–°—Ç–æ–∏–º–æ—Å—Ç—å: +100%
```

---

**–î–∞—Ç–∞:** 2025-10-07  
**–ê–≤—Ç–æ—Ä:** Performance Analysis  
**–í–µ—Ä—Å–∏—è:** 1.0
