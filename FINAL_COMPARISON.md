# üìä –§–ò–ù–ê–õ–¨–ù–û–ï –°–†–ê–í–ù–ï–ù–ò–ï –í–°–ï–• –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ô

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–§–∞–π–ª:** Storage_History_Performance_Files(11-24).zip
- **–ú–µ—Ç—Ä–∏–∫:** 596,626,023 (596 –º–ª–Ω)
- **–§–∞–π–ª–æ–≤:** 2,584 .tgz

---

## üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í

### ‚öôÔ∏è –¢–µ—Å—Ç 1: 16 vCPU + Batch 50k (Baseline)

```
‚úÖ –í—Ä–µ–º—è:          449.9 —Å–µ–∫ (7.5 –º–∏–Ω—É—Ç)
‚úÖ Throughput:     1,326,084 metrics/sec
‚úÖ Workers:        14
‚úÖ Batches:        12,910
‚úÖ Batch size:     50,000
```

### ‚öôÔ∏è –¢–µ—Å—Ç 2: 32 vCPU + Batch 50k

```
‚úÖ –í—Ä–µ–º—è:          331.7 —Å–µ–∫ (5.5 –º–∏–Ω—É—Ç)
‚úÖ Throughput:     1,798,803 metrics/sec
‚úÖ Workers:        30
‚úÖ Batches:        12,910
‚úÖ Batch size:     50,000
```

### ‚öôÔ∏è –¢–µ—Å—Ç 3: 32 vCPU + Batch 100k + VM Tuning (–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

```
‚úÖ –í—Ä–µ–º—è:          334.0 —Å–µ–∫ (5.6 –º–∏–Ω—É—Ç)
‚úÖ Throughput:     1,786,523 metrics/sec
‚úÖ Workers:        30
‚úÖ Batches:        7,747
‚úÖ Batch size:     100,000

VictoriaMetrics –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- maxInsertRequestSize: 128MB
- memory.allowedPercent: 80%
- insert.maxQueueDuration: 60s
```

---

## üìä –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | 16 vCPU<br/>Batch 50k | 32 vCPU<br/>Batch 50k | 32 vCPU<br/>Batch 100k<br/>**Optimized** | –õ—É—á—à–∏–π |
|---------|----------------|----------------|----------------------|---------|
| **–í—Ä–µ–º—è (—Å–µ–∫)** | 449.9 | 331.7 | 334.0 | **32 vCPU Batch 50k** ‚úÖ |
| **–í—Ä–µ–º—è (–º–∏–Ω)** | 7.5 | 5.5 | 5.6 | **32 vCPU Batch 50k** ‚úÖ |
| **Throughput** | 1,326,084 | 1,798,803 | 1,786,523 | **32 vCPU Batch 50k** ‚úÖ |
| **Workers** | 14 | 30 | 30 | - |
| **Batches** | 12,910 | 12,910 | 7,747 | **Optimized** ‚úÖ |
| **HTTP Requests** | 12,910 | 12,910 | 7,747 | **Optimized** ‚úÖ |

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ Baseline (16 vCPU)

```
32 vCPU, Batch 50k:
  –í—Ä–µ–º—è: 449.9 ‚Üí 331.7 —Å–µ–∫ (-26.3%) ‚ö°
  Throughput: +35.6%

32 vCPU, Batch 100k (Optimized):
  –í—Ä–µ–º—è: 449.9 ‚Üí 334.0 —Å–µ–∫ (-25.8%) ‚ö°
  Throughput: +34.7%
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 32 vCPU: Batch 50k vs Batch 100k

```
Batch 50k:   331.7 —Å–µ–∫ | 1,798,803 m/s | 12,910 batches
Batch 100k:  334.0 —Å–µ–∫ | 1,786,523 m/s |  7,747 batches

–†–∞–∑–Ω–∏—Ü–∞:     +2.3 —Å–µ–∫ (+0.7%) | -12,280 m/s (-0.7%) | -40% batches
```

**–í—ã–≤–æ–¥:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ batch size **–ù–ï –¥–∞–ª–æ** –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è!

---

## ü§î –ü–û–ß–ï–ú–£ BATCH 100k –ù–ï –ë–´–°–¢–†–ï–ï?

### –û–∂–∏–¥–∞–Ω–∏–µ vs –†–µ–∞–ª—å–Ω–æ—Å—Ç—å

**–û–∂–∏–¥–∞–ª–∏:**
- –ú–µ–Ω—å—à–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (7,747 vs 12,910) ‚Üí –º–µ–Ω—å—à–µ overhead
- –ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Ä–∞–∑ ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è VM
- **–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:** +20-30%

**–ü–æ–ª—É—á–∏–ª–∏:**
- –í—Ä–µ–º—è –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–µ –∂–µ: 334.0 vs 331.7 —Å–µ–∫ (**+0.7%**)
- Throughput –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ: 1,786k vs 1,799k (**-0.7%**)

### –ü—Ä–∏—á–∏–Ω—ã

#### 1. **VictoriaMetrics - –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 30 Workers       ‚îÇ
‚îÇ Very Fast        ‚îÇ
‚îÇ (Idle 30-40%)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  VictoriaMetrics       ‚îÇ
    ‚îÇ  Write Speed: ~1.8M/s  ‚îÇ
    ‚îÇ  ‚óÑ‚óÑ‚óÑ BOTTLENECK!       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**VM –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é ~1.8M metrics/sec –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç batch size!**

- Batch 50k:  1,798,803 m/s
- Batch 100k: 1,786,523 m/s

**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–Ω–µ–µ 1%!**

#### 2. **Disk I/O VictoriaMetrics**

```
Batch 50k:  12,910 HTTP requests
Batch 100k:  7,747 HTTP requests (-40%)

–ù–û: VM –ø–∏—à–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫!
    596 –º–ª–Ω –º–µ—Ç—Ä–∏–∫ √ó ~150 bytes = ~90 GB

Disk Write Speed: ~750 MB/s (SSD)
Time to write: 90 GB / 750 MB/s = ~120 —Å–µ–∫—É–Ω–¥

–≠—Ç–æ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ~36% –æ—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!
```

#### 3. **Index Building –≤ VictoriaMetrics**

VictoriaMetrics —Å—Ç—Ä–æ–∏—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:
- Inverted index
- Time series index
- Label index

**–≠—Ç–æ CPU-intensive –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ VM, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç batch size!**

#### 4. **–ë–æ–ª—å—à–∏–µ –±–∞—Ç—á–∏ = –±–æ–ª—å—à–µ memory –¥–ª—è VM**

```
Batch 50k:  50,000 √ó 150 bytes = ~7.5 MB –Ω–∞ –±–∞—Ç—á
Batch 100k: 100,000 √ó 150 bytes = ~15 MB –Ω–∞ –±–∞—Ç—á

–ü—Ä–∏ 30 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö workers:
Batch 50k:  30 √ó 7.5 MB = ~225 MB –≤ –ø–∞–º—è—Ç–∏ VM
Batch 100k: 30 √ó 15 MB = ~450 MB –≤ –ø–∞–º—è—Ç–∏ VM

–†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ–ª—å—à–µ GC –ø–∞—É–∑—ã –≤ VM!
```

---

## üí° –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´

### 1. ‚úÖ CPU –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
16 vCPU ‚Üí 32 vCPU = +35.6% throughput
```

**–ù–æ:** —É–¥–≤–æ–µ–Ω–∏–µ CPU –¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ 35% —É—Å–∫–æ—Ä–µ–Ω–∏—è (–Ω–µ 100%)

### 2. ‚ùå Batch size –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
Batch 50k vs Batch 100k = –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ (0.7% —Ä–∞–∑–Ω–∏—Ü–∞)
```

**–ü—Ä–∏—á–∏–Ω–∞:** VictoriaMetrics - –≥–ª–∞–≤–Ω–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ, –Ω–µ HTTP overhead

### 3. üéØ VictoriaMetrics –ø–∏—à–µ—Ç ~1.8M metrics/sec –º–∞–∫—Å–∏–º—É–º

–≠—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç –ø—Ä–∏ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- Disk I/O: 750 MB/s (SSD)
- Index building: CPU VM
- Memory management: GC –ø–∞—É–∑—ã

### 4. üí∞ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–ª—è cost/performance:**
```
vCPU: 16
Batch size: 50,000 (–Ω–µ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å!)
VictoriaMetrics: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

Throughput: 1,326,084 m/s
–í—Ä–µ–º—è –¥–ª—è 500GB: ~8.5 —á–∞—Å–æ–≤
–°—Ç–æ–∏–º–æ—Å—Ç—å: $ (baseline)
```

**–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏:**
```
vCPU: 32
Batch size: 50,000 (100k –Ω–µ –±—ã—Å—Ç—Ä–µ–µ!)
VictoriaMetrics: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

Throughput: 1,798,803 m/s
–í—Ä–µ–º—è –¥–ª—è 500GB: ~6.3 —á–∞—Å–æ–≤
–°—Ç–æ–∏–º–æ—Å—Ç—å: $$ (2x)
```

---

## üöÄ –ö–ê–ö –£–°–ö–û–†–ò–¢–¨ –î–ê–õ–¨–®–ï?

### –í–∞—Ä–∏–∞–Ω—Ç 1: Cluster VictoriaMetrics

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Workers  ‚îÇ ‚îÄ‚îÄ‚ñ∂ ‚îÇ VM Node 1  ‚îÇ
‚îÇ          ‚îÇ     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ          ‚îÇ ‚îÄ‚îÄ‚ñ∂ ‚îÇ VM Node 2  ‚îÇ
‚îÇ          ‚îÇ     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ          ‚îÇ ‚îÄ‚îÄ‚ñ∂ ‚îÇ VM Node 3  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: 2-3x
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Faster Disk –¥–ª—è VM

```
Current: SSD 750 MB/s
NVMe:    3000-5000 MB/s

–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: +30-50%
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è VM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```yaml
victoriametrics:
  command:
    - -inmemoryDataFlushInterval=30s  # —á–∞—â–µ flush –≤ –ø–∞–º—è—Ç—å
    - -maxConcurrentInserts=16        # –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
    - -precisionBits=32               # –º–µ–Ω—å—à–µ precision = –±—ã—Å—Ç—Ä–µ–µ
```

**–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:** +10-20%

---

## ÔøΩÔøΩ –ü–†–û–ì–ù–û–ó –î–õ–Ø 500GB / 40 –º–ª—Ä–¥ —Å—Ç—Ä–æ–∫

### –¢–µ–∫—É—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | Throughput | –í—Ä–µ–º—è | vCPU | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------------|-----------|-------|------|-----------|
| **16 vCPU, Batch 50k** | 1.33M/s | **~8.5—á** | 16 | $ |
| **32 vCPU, Batch 50k** | 1.80M/s | **~6.3—á** | 32 | $$ |
| **32 vCPU, Batch 100k** | 1.79M/s | **~6.3—á** | 32 | $$ |

### –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | Throughput | –í—Ä–µ–º—è | –î–æ–ø. –∑–∞—Ç—Ä–∞—Ç—ã |
|-------------|-----------|-------|--------------|
| **+ NVMe Disk** | 2.3-2.6M/s | **~4-5—á** | $$$ (disk) |
| **+ VM Cluster (3 nodes)** | 4-5M/s | **~2-2.5—á** | $$$$ (3x VM) |

---

## üéì –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–ª—è Production (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

‚úÖ **–í—ã–±–∏—Ä–∞–π—Ç–µ 16 vCPU + Batch 50k**
- –õ—É—á—à–∏–π cost/performance
- Throughput: 1.33M metrics/sec
- –í—Ä–µ–º—è –¥–ª—è 500GB: ~8.5 —á–∞—Å–æ–≤
- –ú–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—á—å—é

### –î–ª—è –°—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á (deadlines)

‚úÖ **–í—ã–±–∏—Ä–∞–π—Ç–µ 32 vCPU + Batch 50k**
- –ù–∞ 35% –±—ã—Å—Ç—Ä–µ–µ
- Throughput: 1.80M metrics/sec
- –í—Ä–µ–º—è –¥–ª—è 500GB: ~6.3 —á–∞—Å–æ–≤
- **Batch 100k –ù–ï –Ω—É–∂–µ–Ω!** (–Ω–µ –¥–∞—ë—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è)

### –î–ª—è –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

‚úÖ **–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤:**
1. NVMe disk –¥–ª—è VictoriaMetrics (+30-50% speed)
2. VM Cluster (3 nodes) (+2-3x speed)
3. 32 vCPU –¥–ª—è workers

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~2-2.5 —á–∞—Å–∞ –¥–ª—è 500GB

---

## üéØ –ì–õ–ê–í–ù–´–ô –í–´–í–û–î

### ‚ö†Ô∏è –£–≤–µ–ª–∏—á–µ–Ω–∏–µ Batch Size –ù–ï –î–ê–õ–û —É—Å–∫–æ—Ä–µ–Ω–∏—è!

**–ü—Ä–∏—á–∏–Ω–∞:** VictoriaMetrics - –≥–ª–∞–≤–Ω–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ
- Disk I/O (36% –≤—Ä–µ–º–µ–Ω–∏)
- Index building (CPU VM)
- –ù–µ HTTP overhead!

### ‚úÖ –ß—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç:

1. **CPU (workers):** 16‚Üí32 vCPU = +35% ‚ö°
2. **Disk Speed:** HDD‚ÜíNVMe = +50-100% ‚ö°‚ö°
3. **VM Cluster:** 1‚Üí3 nodes = +200% ‚ö°‚ö°‚ö°

### ‚ùå –ß—Ç–æ –ù–ï –≤–ª–∏—è–µ—Ç:

1. **Batch Size:** 50k‚Üí100k = 0% (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ!)
2. **Workers >30:** diminishing returns
3. **RAM:** –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 32GB

---

**–î–∞—Ç–∞:** 2025-10-07  
**–¢–µ—Å—Ç—ã:** 3 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
**–í—ã–≤–æ–¥:** CPU –≤–∞–∂–µ–Ω, Batch size –ù–ï –≤–∞–∂–µ–Ω, VM - —É–∑–∫–æ–µ –º–µ—Å—Ç–æ  
**–í–µ—Ä—Å–∏—è:** 1.0 (Final)
