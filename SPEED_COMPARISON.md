# üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–ö–û–†–û–°–¢–ò: –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –∞—Ä—Ö–∏–≤–∞

**–î–∞—Ç–∞:** 2025-10-07  
**–°–∏—Å—Ç–µ–º–∞:** 32 vCPU, 32GB RAM, Batch 100k

---

## üéØ –¢–ï–°–¢ 1: Storage_History_Performance_Files(11-24).zip

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
```
–§–∞–π–ª—ã:          2,584 .tgz
–ú–µ—Ç—Ä–∏–∫:         596,626,023 (596 –º–ª–Ω)
–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: 2102353TJWFSP3100020
–í—Ä–µ–º—è:          334 —Å–µ–∫—É–Ω–¥ (5.6 –º–∏–Ω—É—Ç)
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
```
‚úÖ Worker speed:     53,000-64,000 m/s
‚úÖ Total throughput: 1,786,523 m/s
‚úÖ Files/sec:        7.7 files/sec
‚úÖ Throughput:       ~1.8 –º–ª–Ω metrics/sec
```

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
```
‚Ä¢ DAE —Ñ–∞–π–ª—ã (~220k metrics):      3.7-4.1 —Å–µ–∫
‚Ä¢ OceanStor —Ñ–∞–π–ª—ã (~240k metrics): 3.8-4.0 —Å–µ–∫
‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:                53-64k m/s
```

---

## üéØ –¢–ï–°–¢ 2: (10.7.39.180)ch4-osd8kv6-93-lt_Perf_1725815376268.zip

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
```
–§–∞–π–ª—ã:          7,852 .tgz (–≤ 3x –±–æ–ª—å—à–µ!)
–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: 2102354JMX10PC100010
–í—Ä–µ–º—è (–ø–æ–∫–∞):   68 –º–∏–Ω—É—Ç (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ 44.5%)
–û—Å—Ç–∞–ª–æ—Å—å:       ~85 –º–∏–Ω—É—Ç (ETA: ~2.5 —á–∞—Å–∞ total)
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
```
‚ö†Ô∏è Worker speed:     13,000-15,000 m/s (–í 4 –†–ê–ó–ê –ú–ï–î–õ–ï–ù–ù–ï–ï!)
‚ö†Ô∏è Files/min:        51.3 files/min = 0.86 files/sec
‚ö†Ô∏è Throughput:       ~400k metrics/sec (–æ—Ü–µ–Ω–∫–∞)
```

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
```
‚Ä¢ DAE —Ñ–∞–π–ª—ã (~90k metrics):        5.8-6.8 —Å–µ–∫
‚Ä¢ OceanStor —Ñ–∞–π–ª—ã (~1M metrics):   73-76 —Å–µ–∫ (!)
‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:                13-15k m/s
```

---

## üîç –ê–ù–ê–õ–ò–ó: –ü–æ—á–µ–º—É –º–µ–¥–ª–µ–Ω–Ω–µ–µ?

### 1. üéØ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤

| –ê—Ä—Ö–∏–≤ | DAE —Ñ–∞–π–ª | OceanStor —Ñ–∞–π–ª |
|-------|----------|----------------|
| **–¢–µ—Å—Ç 1** | ~220k metrics | ~240k metrics |
| **–¢–µ—Å—Ç 2** | ~90k metrics | **~1M metrics** |

**–í—ã–≤–æ–¥:** OceanStor —Ñ–∞–π–ª—ã –≤ –¢–µ—Å—Ç–µ 2 —Å–æ–¥–µ—Ä–∂–∞—Ç **–≤ 4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫!**

### 2. üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤

```
–¢–µ—Å—Ç 1: 2,584 —Ñ–∞–π–ª–æ–≤
–¢–µ—Å—Ç 2: 7,852 —Ñ–∞–π–ª–æ–≤ (–≤ 3 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ)
```

### 3. ‚è±Ô∏è –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–¢–µ—Å—Ç 1:**
```
240k metrics –∑–∞ 3.8 —Å–µ–∫ = 63,157 m/s
```

**–¢–µ—Å—Ç 2:**
```
1M metrics –∑–∞ 75 —Å–µ–∫ = 13,333 m/s
```

**–†–∞–∑–Ω–∏—Ü–∞:** –í 4.7 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ!

---

## ü§î –ü–†–ò–ß–ò–ù–´ –ó–ê–ú–ï–î–õ–ï–ù–ò–Ø

### 1. üî• VictoriaMetrics Overhead

–ö–æ–≥–¥–∞ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç **–±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫**, VM —Ç—Ä–∞—Ç–∏—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞:
- Index building (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤)
- Data compression
- Memory management
- Disk writes

**–§–æ—Ä–º—É–ª–∞:**
```
–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ = Parsing Time + VM Write Time

–î–ª—è –º–∞–ª—ã—Ö —Ñ–∞–π–ª–æ–≤ (90-240k):
  Parsing: ~1-2 —Å–µ–∫
  VM Write: ~2-3 —Å–µ–∫
  Total: ~3-5 —Å–µ–∫

–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (~1M):
  Parsing: ~5-10 —Å–µ–∫
  VM Write: ~60-70 —Å–µ–∫ (!!)
  Total: ~75 —Å–µ–∫
```

**–£–∑–∫–æ–µ –º–µ—Å—Ç–æ:** VictoriaMetrics write –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π!

### 2. üíæ Batch Size Impact

```
Batch 100k:
  ‚Ä¢ –î–ª—è —Ñ–∞–π–ª–∞ 90k metrics:   1 batch  = –±—ã—Å—Ç—Ä–æ
  ‚Ä¢ –î–ª—è —Ñ–∞–π–ª–∞ 1M metrics:    10 batches = –º–µ–¥–ª–µ–Ω–Ω–æ

–ö–∞–∂–¥—ã–π batch = HTTP POST + VM processing
–î–ª—è 1M metrics = 10 HTTP requests + 10x VM overhead
```

### 3. üß† Memory Pressure

```
30 workers √ó 1M metrics √ó 150 bytes ‚âà 4.5 GB –≤ –ø–∞–º—è—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

–≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç:
  ‚Ä¢ –ë–æ–ª—å—à–µ GC –ø–∞—É–∑—ã
  ‚Ä¢ –ë–æ–ª—å—à–µ memory allocation
  ‚Ä¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
```

---

## üìà –ü–†–û–ì–ù–û–ó –î–õ–Ø –¢–ï–°–¢–ê 2

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:
```
–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:  3,493 / 7,852 (44.5%)
–í—Ä–µ–º—è:       68 –º–∏–Ω—É—Ç
–û—Å—Ç–∞–ª–æ—Å—å:    4,359 —Ñ–∞–π–ª–æ–≤
```

### –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
```
–°–∫–æ—Ä–æ—Å—Ç—å: 51.3 —Ñ–∞–π–ª–æ–≤/–º–∏–Ω

–û—Å—Ç–∞–ª–æ—Å—å: 4,359 —Ñ–∞–π–ª–æ–≤ / 51.3 —Ñ–∞–π–ª–æ–≤/–º–∏–Ω = 85 –º–∏–Ω—É—Ç

ETA: 68 + 85 = 153 –º–∏–Ω—É—Ç—ã (2.5 —á–∞—Å–∞ total)
```

### –û—Ü–µ–Ω–∫–∞ –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞:
```
–ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å —Å—Ä–µ–¥–Ω–µ–µ ~300k metrics –Ω–∞ —Ñ–∞–π–ª:
7,852 —Ñ–∞–π–ª–æ–≤ √ó 300k = 2.36 –º–ª—Ä–¥ metrics

–ü—Ä–∏ —Ç–µ–∫—É—â–µ–º throughput ~400k m/s:
2,360,000,000 / 400,000 = 5,900 —Å–µ–∫ = 98 –º–∏–Ω—É—Ç
```

**–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ETA!**

---

## üí° –í–´–í–û–î–´

### 1. ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

```
CPU: 100% –Ω–∞ –≤—Å–µ—Ö —è–¥—Ä–∞—Ö (–æ–∂–∏–¥–∞–µ–º–æ)
Workers: 31 –∞–∫—Ç–∏–≤–Ω—ã—Ö (–Ω–æ—Ä–º–∞)
Throughput: ~400k m/s (–∞–¥–µ–∫–≤–∞—Ç–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)
```

### 2. ‚ö†Ô∏è –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã = –º–µ–¥–ª–µ–Ω–Ω–µ–µ

```
–§–∞–π–ª 90k metrics:   ~6 —Å–µ–∫   (15k m/s)
–§–∞–π–ª 1M metrics:    ~75 —Å–µ–∫  (13k m/s)

–ü—Ä–∏—á–∏–Ω–∞: VictoriaMetrics overhead –¥–ª—è index building
```

### 3. üéØ –ù–µ –Ω—É–∂–Ω–æ –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å!

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ–ª–Ω—É—é –º–æ—â–Ω–æ—Å—Ç—å:
- ‚úÖ CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è 100%
- ‚úÖ 31 worker –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ VictoriaMetrics –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ ETA —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è (2.5 —á–∞—Å–∞)

### 4. üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ throughput

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ—Å—Ç 1 | –¢–µ—Å—Ç 2 | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|--------|--------|---------|
| **Worker speed** | 63k m/s | 13k m/s | –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã |
| **Total throughput** | 1.8M m/s | 400k m/s | VM overhead |
| **Files/sec** | 7.7 f/s | 0.86 f/s | –ë–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫ |

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. ‚úÖ –ù–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è—Ç—å —Å–µ–π—á–∞—Å

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤.

### 2. üí° –î–ª—è –±—É–¥—É—â–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:**

#### –í–∞—Ä–∏–∞–Ω—Ç A: –£–º–µ–Ω—å—à–∏—Ç—å Batch Size
```yaml
# –í api/main.py
--batch-size 50000  # –≤–º–µ—Å—Ç–æ 100000
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—å—à–µ overhead –Ω–∞ batch, –Ω–æ –±–æ–ª—å—à–µ HTTP requests
**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +10-15% –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VictoriaMetrics

```yaml
victoriametrics:
  command:
    - -inmemoryDataFlushInterval=5s  # —á–∞—â–µ flush (default 1s)
    - -maxConcurrentInserts=32       # –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** +15-20%

#### –í–∞—Ä–∏–∞–Ω—Ç C: NVMe –¥–∏—Å–∫ –¥–ª—è VM

```
Current SSD: 750 MB/s
NVMe:        3000-5000 MB/s

–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +30-50%
```

#### –í–∞—Ä–∏–∞–Ω—Ç D: VM Cluster (extreme)

```
3 VictoriaMetrics nodes = 3x throughput
–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +200%
```

---

## üìä –§–ò–ù–ê–õ–¨–ù–û–ï –°–†–ê–í–ù–ï–ù–ò–ï

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤:

| –¢–∏–ø —Ñ–∞–π–ª–∞ | –†–∞–∑–º–µ—Ä | –í—Ä–µ–º—è | Speed | –õ—É—á—à–µ –¥–ª—è |
|-----------|--------|-------|-------|-----------|
| **–ú–∞–ª–µ–Ω—å–∫–∏–µ** (90-240k) | Small | ~4 —Å–µ–∫ | 60k m/s | –¢–µ—Å—Ç 1 |
| **–ë–æ–ª—å—à–∏–µ** (~1M) | Large | ~75 —Å–µ–∫ | 13k m/s | –¢–µ—Å—Ç 2 |

### –û–±—â–∏–π throughput:

```
–¢–µ—Å—Ç 1: 596M metrics / 334 —Å–µ–∫ = 1.8M m/s
–¢–µ—Å—Ç 2: ~2.4B metrics / ~9000 —Å–µ–∫ = 267k m/s (estimate)
```

**–†–∞–∑–Ω–∏—Ü–∞:** ~7x –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è 3x –±–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ —Å –±–æ–ª—å—à–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏!

---

## ‚úÖ –í–ï–†–î–ò–ö–¢

### üéØ –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: –ù–û–†–ú–ê–õ–¨–ù–ê–Ø

```
‚úÖ CPU –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 100% (—Ö–æ—Ä–æ—à–æ)
‚úÖ 31 worker –∞–∫—Ç–∏–≤–µ–Ω (–º–∞–∫—Å–∏–º—É–º)
‚úÖ Throughput –∞–¥–µ–∫–≤–∞—Ç–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
‚úÖ ETA —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è (~85 –º–∏–Ω—É—Ç)
‚úÖ VictoriaMetrics —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
```

### ‚è±Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

```
–ù–∞—á–∞–ª–æ:     22:04
–¢–µ–∫—É—â–µ–µ:    23:14 (+70 –º–∏–Ω—É—Ç)
–û—Å—Ç–∞–ª–æ—Å—å:   ~85 –º–∏–Ω—É—Ç
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: ~00:39 (–ø—Ä–∏–º–µ—Ä–Ω–æ)
```

### üí∞ Cost/Performance –æ—Ü–µ–Ω–∫–∞:

```
2.5 —á–∞—Å–∞ √ó 32 vCPU = 80 vCPU-hours
–î–ª—è 2.4 –º–ª—Ä–¥ metrics = —Ö–æ—Ä–æ—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
```

---

**Status:** ‚ö†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ (44.5% –≥–æ—Ç–æ–≤–æ)  
**Recommendation:** –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ  
**Next Steps:** –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å NVMe –¥–∏—Å–∫ –∏–ª–∏ VM cluster
