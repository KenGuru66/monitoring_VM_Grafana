# –†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ò–ú–ü–û–†–¢–ê –í VICTORIAMETRICS

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –í–µ—Ä—Å–∏—è 1: csv2vm_streaming.py (Single-threaded)
```
- –í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞: 152.5 —Å–µ–∫—É–Ω–¥
- –°–∫–æ—Ä–æ—Å—Ç—å: 143,854 rows/sec
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 1 —è–¥—Ä–æ (12-25% –æ—Ç total)
- Workers: 1
- –£–∑–∫–æ–µ –º–µ—Å—Ç–æ: Python GIL + single-threaded
```

### –í–µ—Ä—Å–∏—è 2: csv2vm_parallel.py (Multi-threaded) ‚ö°
```
- –í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞: 51.3 —Å–µ–∫—É–Ω–¥ ‚úÖ
- –°–∫–æ—Ä–æ—Å—Ç—å: 427,239 rows/sec ‚úÖ
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 7 —è–¥–µ—Ä –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- Workers: 7 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: multiprocessing.Pool
```

## üöÄ –£–õ–£–ß–®–ï–ù–ò–Ø

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
| –ú–µ—Ç—Ä–∏–∫–∞              | –î–æ         | –ü–æ—Å–ª–µ      | –£–ª—É—á—à–µ–Ω–∏–µ  |
|----------------------|------------|------------|------------|
| **–í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞**    | 152.5 —Å–µ–∫  | 51.3 —Å–µ–∫   | **3.0x** ‚ö° |
| **–°–∫–æ—Ä–æ—Å—Ç—å**         | 143,854 r/s| 427,239 r/s| **3.0x** ‚ö° |
| **CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**| 1 —è–¥—Ä–æ     | 7 —è–¥–µ—Ä     | **7x** üî•  |

### –ü–æ–ª–Ω—ã–π Pipeline (–ü–∞—Ä—Å–∏–Ω–≥ + –ò–º–ø–æ—Ä—Ç)
| –≠—Ç–∞–ø              | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|-------------------|----------------|-------------------|-----------|
| –ü–∞—Ä—Å–∏–Ω–≥           | 51 —Å–µ–∫         | 51 —Å–µ–∫            | 1x        |
| –ò–º–ø–æ—Ä—Ç            | 152.5 —Å–µ–∫      | 51.3 —Å–µ–∫          | **3x** ‚ö°  |
| **–ò–¢–û–ì–û**         | **203.5 —Å–µ–∫**  | **102.3 —Å–µ–∫**     | **2x** ‚ö°  |

## üî• Per-Worker Performance

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É 7 workers:

```
Worker 1: 3,133,521 rows in 24.5s (128,071 rows/sec)
Worker 2: 3,133,521 rows in 29.3s (106,952 rows/sec)
Worker 3: 3,133,521 rows in 33.2s (94,397 rows/sec)
Worker 4: 3,133,521 rows in 37.7s (83,185 rows/sec)
Worker 5: 3,133,521 rows in 42.1s (74,405 rows/sec)
Worker 6: 3,133,521 rows in 46.5s (67,422 rows/sec)
Worker 7: 3,133,527 rows in 51.3s (61,066 rows/sec)
```

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ**: Workers –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ HTTP bottleneck.

## üí° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ csv2vm_parallel.py:
1. **multiprocessing.Pool**: –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ –∏–∑ 7 worker –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. **Chunking**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ CSV —Ñ–∞–π–ª–∞ –Ω–∞ —Ä–∞–≤–Ω—ã–µ chunks –¥–ª—è –∫–∞–∂–¥–æ–≥–æ worker
3. **–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ö–∞–∂–¥—ã–π worker —á–∏—Ç–∞–µ—Ç —Å–≤–æ–π chunk –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ VM
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GIL**: multiprocessing –æ–±—Ö–æ–¥–∏—Ç Python GIL, –ø–æ–∑–≤–æ–ª—è—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —è–¥—Ä–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
CSV File (21.9M rows, 2.1 GB)
    ‚Üì
Split into 7 chunks
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇWorker 1 ‚îÇWorker 2 ‚îÇWorker 3 ‚îÇWorker 4 ‚îÇWorker 5 ‚îÇWorker 6 ‚îÇWorker 7 ‚îÇ
‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ3.1M rows‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ         ‚îÇ         ‚îÇ         ‚îÇ         ‚îÇ         ‚îÇ         ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
                      VictoriaMetrics
                   (HTTP POST batches)
```

## üéØ –í—ã–≤–æ–¥—ã

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
1. **–ò–º–ø–æ—Ä—Ç —É—Å–∫–æ—Ä–µ–Ω –≤ 3 —Ä–∞–∑–∞**: —Å 152.5 —Å–µ–∫ –¥–æ 51.3 —Å–µ–∫
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤—Å–µ CPU —è–¥—Ä–∞**: 7 –∏–∑ 8 —è–¥–µ—Ä —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **–û–±—â–µ–µ –≤—Ä–µ–º—è pipeline —Å–æ–∫—Ä–∞—â–µ–Ω–æ –≤ 2 —Ä–∞–∑–∞**: —Å 203.5 —Å–µ–∫ –¥–æ 102.3 —Å–µ–∫

### üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- –ù–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —è–¥–µ—Ä —É—Å–∫–æ—Ä–µ–Ω–∏–µ –±—É–¥–µ—Ç –µ—â–µ –≤—ã—à–µ
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ 16 —è–¥–µ—Ä –º–æ–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å ~800,000-1,000,000 rows/sec

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å csv2vm_parallel.py** –¥–ª—è –≤—Å–µ—Ö –±–æ–ª—å—à–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ (>1M —Å—Ç—Ä–æ–∫)
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å csv2vm_streaming.py** –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ (<1M —Å—Ç—Ä–æ–∫)
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ workers**: –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `--workers N`

### üöÄ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ workers
python3 csv2vm_parallel.py output/2102353TJWFSP3100020.csv

# –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
python3 csv2vm_parallel.py output/2102353TJWFSP3100020.csv --workers 7

# –° –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º batch size
python3 csv2vm_parallel.py output/2102353TJWFSP3100020.csv --batch 100000
```

## üìù –ò—Å—Ç–æ—Ä–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –í–µ—Ä—Å–∏—è 0.1: csv2vm_streaming.py
- –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ù–∏–∑–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ 1 CPU —è–¥—Ä–æ

### –í–µ—Ä—Å–∏—è 0.2: csv2vm_parallel.py ‚ö°
- Multiprocessing
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —è–¥—Ä–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞

---

**–î–∞—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: 2025-10-01  
**–¢–µ—Å—Ç–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç**: 21.9M rows, 2.1 GB CSV
