# docker-compose.prod.yml - Production конфигурация с bind mounts к /data/
# Использование: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# Требуется создать директории на хосте:
#   sudo mkdir -p /data/vmdata /data/grafana /data/jobs /data/perf-dumps/dumps
#   sudo chown -R $(id -u):$(id -g) /data/vmdata /data/grafana /data/jobs /data/perf-dumps

services:
  victoriametrics:
    volumes:
      - /data/vmdata:/vmdata  # Bind mount на быстрый диск (переопределяет named volume)

  grafana:
    volumes:
      - /data/grafana:/var/lib/grafana
      - ./grafana/provisioning/datasources:/etc/grafana/provisioning/datasources
      - ./grafana/provisioning/dashboards:/etc/grafana/provisioning/dashboards

  api:
    volumes:
      - ./uploads:/app/uploads
      - /data/jobs:/app/jobs  # Bind mount для CSV файлов
      - ./parsers:/app/parsers
      - ./tools:/app/tools
      - ./perfmonkey:/app/perfmonkey
      - ./api:/app/api

  # Perf Watcher - автоматический парсинг Performance Dumps
  perf-watcher:
    volumes:
      - /data/perf-dumps/dumps:/data/perf-dumps/dumps  # SFTP директория с dumps
      - /data/logs/perf-watcher:/app/logs              # Логи watcher на хосте
      - ./parsers:/app/parsers
