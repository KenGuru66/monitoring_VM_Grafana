# Huawei OceanStor Performance Monitoring Pipeline

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Huawei OceanStor —Å –∏–º–ø–æ—Ä—Ç–æ–º –≤ VictoriaMetrics –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ Grafana.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#–æ—á–∏—Å—Ç–∫–∞-–¥–∞–Ω–Ω—ã—Ö)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pipeline –¥–ª—è:

1. **–ü–∞—Ä—Å–∏–Ω–≥** –∞—Ä—Ö–∏–≤–æ–≤ Huawei Performance Data (ZIP ‚Üí TGZ ‚Üí XML ‚Üí CSV)
2. **–ò–º–ø–æ—Ä—Ç** –¥–∞–Ω–Ω—ã—Ö –≤ VictoriaMetrics (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
3. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** –º–µ—Ç—Ä–∏–∫ –≤ Grafana

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ CPU —è–¥—Ä–∞  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ workers** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Å–∏—Å—Ç–µ–º—É (4-128 CPU)  
‚úÖ **–£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–º—è—Ç–∏** - —É—á–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π RAM  
‚úÖ **Batch –∏–º–ø–æ—Ä—Ç** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **Streaming –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏  
‚úÖ **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫** - –≤—ã–±–æ—Ä DEFAULT –∏–ª–∏ ALL –º–µ—Ç—Ä–∏–∫  

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 HUAWEI PERFORMANCE DATA                     ‚îÇ
‚îÇ              Storage_History_Performance.zip                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –≠–¢–ê–ü 1: –ü–ê–†–°–ò–ù–ì (Parallel)                     ‚îÇ
‚îÇ    Huawei_perf_parser_v0.2_parallel.py                      ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ZIP ‚Üí TGZ ‚Üí XML ‚Üí CSV (2+ GB)                              ‚îÇ
‚îÇ  ‚îú‚îÄ Worker 1  ‚îú‚îÄ Worker 2  ‚îú‚îÄ Worker 3  ...                ‚îÇ
‚îÇ  ‚îî‚îÄ –í—Ä–µ–º—è: ~50 —Å–µ–∫ | CPU: 97-99%                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             –≠–¢–ê–ü 2: –ò–ú–ü–û–†–¢ (Parallel)                       ‚îÇ
‚îÇ           csv2vm_parallel.py                                ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  CSV ‚Üí VictoriaMetrics (Prometheus format)                  ‚îÇ
‚îÇ  ‚îú‚îÄ Worker 1 ‚Üí Batch 50k rows                              ‚îÇ
‚îÇ  ‚îú‚îÄ Worker 2 ‚Üí Batch 50k rows                              ‚îÇ
‚îÇ  ‚îî‚îÄ –í—Ä–µ–º—è: ~3-5 –º–∏–Ω | Throughput: 50k rows/sec             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              VICTORIAMETRICS (TSDB)                         ‚îÇ
‚îÇ           localhost:8428                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚Ä¢ –•—Ä–∞–Ω–µ–Ω–∏–µ: 6 –º–µ—Å—è—Ü–µ–≤                                      ‚îÇ
‚îÇ  ‚Ä¢ Prometheus-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                GRAFANA DASHBOARDS                           ‚îÇ
‚îÇ              localhost:3000                                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚Ä¢ Auto-provisioned datasource                             ‚îÇ
‚îÇ  ‚Ä¢ Pre-configured dashboards                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
cd /data/projects/monitoring_VM_Grafana
docker-compose up -d
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- VictoriaMetrics: http://localhost:8428
- Grafana: http://localhost:3000 (admin / changeme)

### 2. –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ pipeline

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ (DEFAULT –º–µ—Ç—Ä–∏–∫–∏)
python3 huawei_to_vm_pipeline.py -i "/path/to/Storage_History_Performance_Files.zip"

# –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º CSV —Ñ–∞–π–ª–æ–≤
python3 huawei_to_vm_pipeline.py -i "/path/to/archive.zip" --keep-csv

# –ü–∞—Ä—Å–∏–Ω–≥ –í–°–ï–• –º–µ—Ç—Ä–∏–∫ (–≤–º–µ—Å—Ç–æ DEFAULT)
python3 huawei_to_vm_pipeline.py -i "/path/to/archive.zip" --all-metrics
```

### 3. –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

```bash
# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º –≤ –ª–æ–≥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
nohup python3 huawei_to_vm_pipeline.py \
  -i "/data/perf_logs/Storage_History_Performance_Files(11-24).zip" \
  --all-metrics \
  > pipeline_all_metrics.log 2>&1 &

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
tail -f pipeline_all_metrics.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep huawei_to_vm_pipeline
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.8+**
- **Docker & Docker Compose**
- **–°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ**: ~10+ GB –¥–ª—è –¥–∞–Ω–Ω—ã—Ö VictoriaMetrics

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `requests` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è VictoriaMetrics API
- `pandas` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `click` - CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞—Ä—Å–µ—Ä–∞
- `tqdm` - –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
- `psutil` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 2. –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
docker-compose up -d
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# VictoriaMetrics
curl http://localhost:8428/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: OK

# Grafana
curl http://localhost:3000/api/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"database":"ok",...}
```

---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω—ã–π pipeline (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
python3 huawei_to_vm_pipeline.py -i "archive.zip" [OPTIONS]
```

**–û–ø—Ü–∏–∏:**

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-------|----------|--------------|
| `-i, --input` | –ü—É—Ç—å –∫ ZIP –∞—Ä—Ö–∏–≤—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) | - |
| `-o, --output-dir` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è CSV —Ñ–∞–π–ª–æ–≤ | `Data2csv/output` |
| `--vm-url` | URL VictoriaMetrics API | `http://localhost:8428/api/v1/import/prometheus` |
| `-w, --workers` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ workers | auto (CPU-1) |
| `--batch-size` | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ | 50000 |
| `--keep-csv` | –ù–µ —É–¥–∞–ª—è—Ç—å CSV –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ | False |
| `--all-metrics` | –ü–∞—Ä—Å–∏—Ç—å –í–°–ï –º–µ—Ç—Ä–∏–∫–∏ (–Ω–µ —Ç–æ–ª—å–∫–æ DEFAULT) | False |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# 1. –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å DEFAULT –º–µ—Ç—Ä–∏–∫–∞–º–∏
python3 huawei_to_vm_pipeline.py -i "Data2csv/logs/archive.zip"

# 2. –ü–∞—Ä—Å–∏–Ω–≥ –í–°–ï–• –º–µ—Ç—Ä–∏–∫
python3 huawei_to_vm_pipeline.py -i "archive.zip" --all-metrics

# 3. –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö CSV
python3 huawei_to_vm_pipeline.py -i "archive.zip" --keep-csv

# 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ workers
python3 huawei_to_vm_pipeline.py -i "archive.zip" --workers 8

# 5. –§–æ–Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
nohup python3 huawei_to_vm_pipeline.py \
  -i "/data/perf_logs/Storage_History_Performance_Files(11-24).zip" \
  --all-metrics \
  > pipeline_all_metrics.log 2>&1 &

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f pipeline_all_metrics.log
```

### –ü–æ—ç—Ç–∞–ø–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –±–æ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–∞–ø—ã –æ—Ç–¥–µ–ª—å–Ω–æ:

#### –≠—Ç–∞–ø 1: –ü–∞—Ä—Å–∏–Ω–≥

```bash
python3 Data2csv/Huawei_perf_parser_v0.2_parallel.py \
  -i "archive.zip" \
  -o "Data2csv/output" \
  -w 7 \
  --all-metrics
```

#### –≠—Ç–∞–ø 2: –ò–º–ø–æ—Ä—Ç

```bash
python3 csv2vm_parallel.py \
  "Data2csv/output/2102353TJWFSP3100020.csv" \
  --url "http://localhost:8428/api/v1/import/prometheus" \
  --batch 50000 \
  --workers 7
```

---

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Workers

–°–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers:

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ CPU

| CPU —è–¥–µ—Ä | Workers | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|---------|------------|
| 4-8 | CPU - 1 | –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—á—Ç–∏ –≤—Å–µ —è–¥—Ä–∞ |
| 8-16 | CPU - 1 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| 16-32 | max 16 | Bottleneck –≤ I/O, –Ω–µ CPU |
| 32+ | max 20 | Bottleneck –≤ —Å–µ—Ç–∏ |

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | Workers |
|--------------|---------|
| < 100 MB | 2 |
| 100 MB - 1 GB | 4 |
| 1-5 GB | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –¥–ª—è CPU |
| > 5 GB | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–ª—è CPU |

### –£—á–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

- **CPU load > 70%** ‚Üí —É–º–µ–Ω—å—à–µ–Ω–∏–µ workers –Ω–∞ 1
- **CPU load > 50%** ‚Üí —É–º–µ–Ω—å—à–µ–Ω–∏–µ workers –Ω–∞ 20%
- **–î–æ—Å—Ç—É–ø–Ω–∞—è RAM** ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –ø–∞–º—è—Ç–∏ (~300 MB/worker)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
monitoring_VM_Grafana/
‚îú‚îÄ‚îÄ huawei_to_vm_pipeline.py          # –ì–ª–∞–≤–Ω—ã–π pipeline —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ csv2vm_parallel.py                # –ò–º–ø–æ—Ä—Ç CSV ‚Üí VictoriaMetrics
‚îú‚îÄ‚îÄ requirements.txt                  # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ docker-compose.yml                # Docker —Å–µ—Ä–≤–∏—Å—ã (VM + Grafana)
‚îú‚îÄ‚îÄ README.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ Data2csv/                         # –ü–∞—Ä—Å–µ—Ä Huawei –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ Huawei_perf_parser_v0.2_parallel.py
‚îÇ   ‚îú‚îÄ‚îÄ METRIC_DICT.py               # –°–ª–æ–≤–∞—Ä—å –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ RESOURCE_DICT.py             # –°–ª–æ–≤–∞—Ä—å —Ä–µ—Å—É—Ä—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ def_metrics                  # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
‚îÇ
‚îî‚îÄ‚îÄ grafana/                          # Grafana –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ provisioning/
        ‚îú‚îÄ‚îÄ datasources/             # Auto-provisioned VictoriaMetrics
        ‚îî‚îÄ‚îÄ dashboards/              # Pre-configured dashboards
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

### DEFAULT –º–µ—Ç—Ä–∏–∫–∏ (–±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

- **CPU**: Avg/Max CPU Usage
- **Memory**: Avg Memory Usage
- **IOPS**: Read/Write IOPS
- **Throughput**: Read/Write Bandwidth (MB/s)
- **Latency**: Read/Write Latency (ms)
- **Cache**: Hit Ratio

### ALL –º–µ—Ç—Ä–∏–∫–∏ (–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

–° –æ–ø—Ü–∏–µ–π `--all-metrics` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è **–≤—Å–µ** –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ METRIC_DICT –∏ RESOURCE_DICT:

- –í—Å–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (Controller A/B)
- Disk Pool –º–µ—Ç—Ä–∏–∫–∏
- Front-end & Back-end –ø–æ—Ä—Ç—ã
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ ALL –º–µ—Ç—Ä–∏–∫ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–µ—Å—Ç–∞ –≤ –ë–î.

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Docker —Å–µ—Ä–≤–∏—Å—ã

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `docker-compose.yml`:

```yaml
VM_PORT=8428                    # –ü–æ—Ä—Ç VictoriaMetrics
VM_RETENTION=6                  # –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–º–µ—Å—è—Ü—ã)
GRAFANA_PORT=3000              # –ü–æ—Ä—Ç Grafana
GRAFANA_ADMIN_PASS=changeme    # –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

### VictoriaMetrics

- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: `/data/vmdata` (host path)
- **Retention**: 6 –º–µ—Å—è—Ü–µ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **API**: http://localhost:8428

### Grafana

- **Datasource**: VictoriaMetrics (auto-provisioned)
- **–õ–æ–≥–∏–Ω**: admin / changeme
- **Dashboards**: Pre-configured –¥–ª—è Huawei OceanStor

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–∏–ø–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

**–°–∏—Å—Ç–µ–º–∞:** 24 CPU cores, 64 GB RAM

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | Throughput | Workers |
|------|-------|------------|---------|
| –ü–∞—Ä—Å–∏–Ω–≥ | ~50 —Å–µ–∫ | 40 MB/s | 7 |
| –ò–º–ø–æ—Ä—Ç | ~3-5 –º–∏–Ω | 50k rows/s | 7 |

**–§–∞–π–ª:** ~2.1 GB CSV (50M+ rows)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

1. **–ë–æ–ª—å—à–µ workers** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ CPU/RAM)
2. **–£–≤–µ–ª–∏—á–∏—Ç—å batch-size** –¥–æ 100000 –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. **SSD –¥–∏—Å–∫** –¥–ª—è VictoriaMetrics storage –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –∏–º–ø–æ—Ä—Ç

---

## üêõ Troubleshooting

### Pipeline –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f pipeline.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å VictoriaMetrics
curl http://localhost:8428/health
```

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏

```bash
# –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
python3 huawei_to_vm_pipeline.py -i "archive.zip" --workers 4

# –£–º–µ–Ω—å—à–∏—Ç—å batch size
python3 huawei_to_vm_pipeline.py -i "archive.zip" --batch-size 25000
```

### VictoriaMetrics –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart victoriametrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs victoriametrics
```

### CSV —Ñ–∞–π–ª—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

```bash
# –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
rm -f Data2csv/output/*.csv
```

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö / –Ω—É–∂–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –ë–î

```bash
# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={SN="2102353TJWFSP3100020"}'
curl -X POST http://localhost:8428/internal/force_merge
sleep 30  # –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã (—Å–º. —Ä–∞–∑–¥–µ–ª "–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö")
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~".+"}'
curl -X POST http://localhost:8428/internal/force_merge
sleep 30  # –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

# –û–±–Ω–æ–≤–∏—Ç—å Grafana –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Ctrl+R)
```

---

## üìù –õ–æ–≥–∏

Pipeline —Å–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤:

- `pipeline.log` - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ pipeline
- `csv2vm_parallel.log` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞
- `pipeline_all_metrics.log` - –ª–æ–≥ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `--all-metrics`

–õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ‚ùå –û—à–∏–±–∫–∏ —Å trace

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ TSDB –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:8428/api/v1/status/tsdb

# 2. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –≤ –±–∞–∑–µ
curl http://localhost:8428/api/v1/label/__name__/values

# 3. –°–ø–∏—Å–æ–∫ —Å–µ—Ä–∏–π–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ (SN) –≤ –±–∞–∑–µ
curl http://localhost:8428/api/v1/label/SN/values

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ (time series)
curl 'http://localhost:8428/api/v1/query?query=count({__name__=~"huawei_.+"})'

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –ø–æ SN
curl 'http://localhost:8428/api/v1/query?query=huawei_avg_cpu_usage_percent{SN="2102353TJWFSP3100020"}'

# 6. –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
curl 'http://localhost:8428/api/v1/query?query=huawei_avg_cpu_usage_percent' | jq '.data.result[0]'
```

### –ß–µ—Ä–µ–∑ Grafana

1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000
2. Login: admin / changeme
3. Dashboards ‚Üí Browse
4. –í—ã–±—Ä–∞—Ç—å pre-configured dashboard

---

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ (–ø–æ SN)

```bash
# –®–∞–≥ 1: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–∏–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={SN="2102353TJWFSP3100020"}'

# –®–∞–≥ 2: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
curl -X POST http://localhost:8428/internal/force_merge

# –®–∞–≥ 3: –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-30 —Å–µ–∫—É–Ω–¥

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
curl http://localhost:8428/api/v1/label/SN/values

# –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å Grafana (Ctrl+R –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

```bash
# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç—Ä–∏–∫–∏ CPU
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~"huawei_.*cpu.*"}'

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ
curl -X POST http://localhost:8428/internal/force_merge

# –£–¥–∞–ª–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~"huawei_.+"}' \
  -d 'start=2024-01-01T00:00:00Z' \
  -d 'end=2024-01-31T23:59:59Z'

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ
curl -X POST http://localhost:8428/internal/force_merge
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª—è–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ VictoriaMetrics!

# –®–∞–≥ 1: –ü–æ–º–µ—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~".+"}'

# –®–∞–≥ 2: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
curl -X POST http://localhost:8428/internal/force_merge

# –®–∞–≥ 3: –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)
curl http://localhost:8428/api/v1/label/__name__/values
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** VictoriaMetrics –Ω–µ —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ! 

–ü–æ—Å–ª–µ `delete_series` –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ **–ø–æ–º–µ—á–∞—é—Ç—Å—è** –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è. –î–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ:
1. –í—ã–∑–≤–∞—Ç—å `/internal/force_merge` (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (10-30 —Å–µ–∫)
3. –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ Grafana (Ctrl+R –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ Refresh)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞):**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose down
sudo rm -rf /data/vmdata/*
docker-compose up -d
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

```bash
# –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –º–µ—Ç—Ä–∏–∫
curl http://localhost:8428/api/v1/label/__name__/values

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
curl http://localhost:8428/api/v1/status/tsdb

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä–∏–π–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
curl http://localhost:8428/api/v1/label/SN/values
```

**üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

```bash
# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –í–°–ï–• –º–∞—Å—Å–∏–≤–æ–≤ Huawei
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~"huawei_.+"}'
curl -X POST http://localhost:8428/internal/force_merge

# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ SN
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={SN!="2102353TJWFSP3100020"}'
curl -X POST http://localhost:8428/internal/force_merge

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ä—à–µ 3 –º–µ—Å—è—Ü–µ–≤)
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series \
  -d 'match[]={__name__=~"huawei_.+"}' \
  -d 'end='$(date -d '3 months ago' -Iseconds)
curl -X POST http://localhost:8428/internal/force_merge
```

**üîß –ü–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É?**

VictoriaMetrics –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LSM-–¥–µ—Ä–µ–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `delete_series`:
1. –î–∞–Ω–Ω—ã–µ **–ø–æ–º–µ—á–∞—é—Ç—Å—è** –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (tombstone markers)
2. –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–ª–∏—è–Ω–∏–∏ (merge) –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é merge –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ —á–µ—Ä–µ–∑ `/internal/force_merge`

**üîÑ –¢–∏–ø–∏—á–Ω—ã–π workflow –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:**

```bash
# 1. –£–¥–∞–ª–µ–Ω–∏–µ
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series -d 'match[]={__name__=~".+"}'

# 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ
curl -X POST http://localhost:8428/internal/force_merge

# 3. –û–∂–∏–¥–∞–Ω–∏–µ (10-30 —Å–µ–∫—É–Ω–¥)
sleep 30

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8428/api/v1/label/__name__/values

# 5. –û–±–Ω–æ–≤–∏—Ç—å Grafana –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Ctrl+R)
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

## üë§ –ê–≤—Ç–æ—Ä

Monitoring VM Grafana Team

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [VictoriaMetrics Documentation](https://docs.victoriametrics.com/)
- [Grafana Documentation](https://grafana.com/docs/)
- [Prometheus Exposition Format](https://prometheus.io/docs/instrumenting/exposition_formats/)

---

**üéâ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:
```bash
docker-compose up -d
python3 huawei_to_vm_pipeline.py -i "your_archive.zip"
```
