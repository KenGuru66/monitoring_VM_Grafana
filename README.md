# Huawei Performance Data Processing Pipeline

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Huawei OceanStor –∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ VictoriaMetrics.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pipeline
```bash
# –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏: –ø–∞—Ä—Å–∏–Ω–≥ + –∏–º–ø–æ—Ä—Ç
python3 huawei_to_vm_pipeline.py -i "Data2csv/logs/Storage_History_Performance_Files.zip"
```

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ workers

–°–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- üñ•Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ CPU —è–¥–µ—Ä (—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –ø–æ–¥ 4-128 CPU)
- üíæ –î–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏
- üìÅ –†–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
- ‚ö° –¢–µ–∫—É—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:**
- 4-8 CPU ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CPU - 1 workers
- 8-16 CPU ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CPU - 1 workers
- 16-32 CPU ‚Üí –º–∞–∫—Å–∏–º—É–º 16 workers (bottleneck –≤ I/O)
- 32+ CPU ‚Üí –º–∞–∫—Å–∏–º—É–º 20 workers (bottleneck –≤ —Å–µ—Ç–∏)

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤:**
- –§–∞–π–ª 50 MB ‚Üí 2 workers
- –§–∞–π–ª 500 MB ‚Üí 4 workers  
- –§–∞–π–ª 2+ GB ‚Üí max workers –¥–ª—è —Å–∏—Å—Ç–µ–º—ã

–í—ã –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å** –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `--workers N`

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –≠—Ç–∞–ø 1: –ü–∞—Ä—Å–∏–Ω–≥ (–∞–≤—Ç–æ workers)
```
ZIP –∞—Ä—Ö–∏–≤ ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ .tgz ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ XML ‚Üí CSV (2.1 GB)
           ‚Üì                  ‚Üì              ‚Üì
        Worker 1           Worker 1       Worker 1
        Worker 2           Worker 2       Worker 2
        Worker 3           Worker 3       Worker 3
        ...                ...            ...
        
–í—Ä–µ–º—è: 51 —Å–µ–∫ | CPU: 7 —è–¥–µ—Ä @ 97-99%
```

### –≠—Ç–∞–ø 2: –ò–º–ø–æ—Ä—Ç (7 workers –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
```
CSV ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ chunks ‚Üí Prometheus —Ñ–æ—Ä–º–∞—Ç ‚Üí VictoriaMetrics
     ‚Üì                       ‚Üì                    ‚Üì
  Worker 1 (3.1M rows)    Worker 1            HTTP POST
  Worker 2 (3.1M rows)    Worker 2            HTTP POST
  Worker 3 (3.1M rows)    Worker 3            HTTP POST
  ...                     ...                 ...
  
–í—Ä–µ–º—è: 51.3 —Å–µ–∫ | –°–∫–æ—Ä–æ—Å—Ç—å: 427K rows/sec | CPU: 7 —è–¥–µ—Ä
```

### –û–±—Ö–æ–¥ Python GIL
```python
# multiprocessing —Å–æ–∑–¥–∞—ë—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (–Ω–µ threads)
# –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ö–æ–¥–∏—Ç GIL ‚Üí –Ω–∞—Å—Ç–æ—è—â–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å
from multiprocessing import Pool
with Pool(processes=7) as pool:
    pool.map(work, tasks)  # 7 CPU —è–¥–µ—Ä —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –°–∫–æ—Ä–æ—Å—Ç—å | CPU |
|------|-------|----------|-----|
| –ü–∞—Ä—Å–∏–Ω–≥ | 51 —Å–µ–∫ | 5.4 —Ñ–∞–π–ª–æ–≤/—Å–µ–∫ | 7 —è–¥–µ—Ä |
| –ò–º–ø–æ—Ä—Ç | 51.3 —Å–µ–∫ | 427,239 rows/sec | 7 —è–¥–µ—Ä |
| **–ò–¢–û–ì–û** | **102 —Å–µ–∫** | - | **7 —è–¥–µ—Ä** |

**–£–ª—É—á—à–µ–Ω–∏–µ vs single-thread:** 3x –±—ã—Å—Ç—Ä–µ–µ, 7x –±–æ–ª—å—à–µ CPU

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```bash
# –®–∞–≥ 1: –ü–∞—Ä—Å–∏–Ω–≥
cd Data2csv
python3 Huawei_perf_parser_v0.2_parallel.py -i "logs/file.zip" -o output

# –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç
cd ..
python3 csv2vm_parallel.py Data2csv/output/*.csv
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
```bash
# –ü–∞—Ä—Å–µ—Ä
-i INPUT    # ZIP/TGZ —Ñ–∞–π–ª
-o OUTPUT   # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è CSV
-w WORKERS  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ workers (default: CPU-1)

# –ò–º–ø–æ—Ä—Ç–µ—Ä
--url URL      # VictoriaMetrics URL
--workers N    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
--batch SIZE   # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (default: 50000)
```

## üßπ –û—á–∏—Å—Ç–∫–∞
```bash
# –£–¥–∞–ª–∏—Ç—å CSV
rm -rf Data2csv/output/*.csv

# –û—á–∏—Å—Ç–∏—Ç—å VictoriaMetrics
curl -X POST http://localhost:8428/api/v1/admin/tsdb/delete_series -d 'match[]={__name__=~"hu_.*"}'
```

## üìÅ –§–∞–π–ª—ã
- `huawei_to_vm_pipeline.py` - –ï–¥–∏–Ω—ã–π pipeline —Å–∫—Ä–∏–ø—Ç
- `csv2vm_parallel.py` - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç–µ—Ä
- `Data2csv/Huawei_perf_parser_v0.2_parallel.py` - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä

---
**–í–µ—Ä—Å–∏—è:** 0.2 Parallel | **–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ
